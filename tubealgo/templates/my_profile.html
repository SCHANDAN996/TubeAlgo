{% extends "app_layout.html" %}

{% block app_content %}
<div class="max-w-4xl mx-auto">
    
    <!-- === === === यह रहा आपका बदलाव === === === -->
    <div class="mb-12">
        <h1 class="text-4xl font-bold text-foreground font-display">Welcome back, {{ display_name or 'User' }}!</h1>
        <p class="text-lg text-muted-foreground mt-2">Manage your personal information, subscription plan, and app settings below.</p>
    </div>
    <!-- === === === === === === === === === === -->

    <div class="space-y-8">

        <!-- === प्रोफ़ाइल कार्ड === -->
        <div class="bg-card p-6 sm:p-8 rounded-xl border shadow-sm">
            <form method="POST" action="{{ url_for('settings.my_profile') }}">
                {{ form.csrf_token }} <!-- CSRF Token zaroori hai -->
                <div class="flex items-center gap-4 mb-6">
                    <img src="{{ current_user.profile_pic or url_for('static', filename='img/logo.png') }}" alt="Profile" class="w-16 h-16 rounded-full border-2 border-primary p-1">
                    <div>
                        <h2 class="text-xl font-bold text-foreground">{{ display_name or 'User' }}</h2>
                        <p class="text-sm text-muted-foreground">{{ current_user.email }}</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="name" class="font-medium text-foreground">Full Name:</label>
                        <input type="text" name="name" id="name" class="mt-1 w-full bg-background border border-input rounded-lg px-4 py-2" value="{{ display_name or '' }}" placeholder="Enter your full name">
                    </div>
                    <div>
                        <label for="phone_number" class="font-medium text-foreground">Phone Number:</label>
                        <p class="text-sm text-muted-foreground mb-1">Required for payment processing.</p>
                        <input type="text" name="phone_number" id="phone_number" class="mt-1 w-full bg-background border border-input rounded-lg px-4 py-2" value="{{ current_user.phone_number or '' }}" placeholder="Enter your 10-digit phone number">
                    </div>
                </div>
                <div class="text-right mt-6">
                    <button type="submit" name="action" value="update_profile" class="bg-primary text-primary-foreground px-6 py-2 rounded-lg font-semibold w-full sm:w-auto">Save Profile</button>
                </div>
            </form>
        </div>

        <!-- === प्लान कार्ड === -->
        <div class="bg-card p-6 sm:p-8 rounded-xl border shadow-sm">
            <h2 class="text-2xl font-bold text-foreground mb-4">Current Plan</h2>
            {% if plan %}
                <h3 class="text-3xl font-display font-bold text-brand-cyan">{{ plan.name }}</h3>
                <p class="text-lg text-muted-foreground mt-1">₹{{ "%.0f"|format(plan.price) }} / 
                    {% if plan.duration_days == 30 %}Monthly
                    {% elif plan.duration_days == 365 %}Yearly
                    {% else %}{{ plan.duration_days }} Days
                    {% endif %}
                </p>
                <p class="mt-4 text-sm font-semibold">Status: 
                    <span class="capitalize px-2 py-1 rounded-full 
                        {% if current_user.subscription_status == 'active' %} bg-green-500/10 text-green-600
                        {% elif current_user.subscription_status == 'cancelled' %} bg-red-500/10 text-red-600
                        {% else %} bg-yellow-500/10 text-yellow-600
                        {% endif %}">
                        {{ current_user.subscription_status }}
                    </span>
                </p>
                <a href="{{ url_for('core.pricing') }}" class="mt-6 inline-block w-full sm:w-auto text-center bg-secondary text-secondary-foreground px-6 py-2 rounded-lg font-semibold hover:bg-border">Manage Subscription</a>
            {% else %}
                <h3 class="text-2xl font-display font-bold text-brand-cyan">Free Plan</h3>
                <p class="text-muted-foreground mt-1">You are currently on the Free Plan.</p>
                <a href="{{ url_for('core.pricing') }}" class="mt-6 inline-block w-full sm:w-auto text-center bg-primary text-primary-foreground px-6 py-2 rounded-lg font-semibold hover:bg-primary/90">Upgrade Plan</a>
            {% endif %}
        </div>
        
        <!-- === सेटिंग्स का बटन === -->
        <a href="{{ url_for('settings.settings') }}" class="group block bg-card p-6 rounded-xl border hover:border-primary hover:shadow-lg transition-all">
            <div class="flex items-center gap-6">
                <div class="w-12 h-12 flex-shrink-0 rounded-lg flex items-center justify-center bg-gray-500/10 text-gray-600">
                    <i class="fa-solid fa-sliders text-2xl"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-foreground">App Settings</h2>
                    <p class="text-muted-foreground mt-1">Manage timezone, AI defaults, Telegram alerts, and account data.</p>
                </div>
                <div class="ml-auto">
                    <i class="fa-solid fa-arrow-right text-muted-foreground group-hover:text-primary transition-colors"></i>
                </div>
            </div>
        </a>

    </div>
</div>
{% endblock %}
